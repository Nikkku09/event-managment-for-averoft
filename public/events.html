<!DOCTYPE html>
<html>
<head>
  <title>Create Event</title>
  <style>
    body { font-family: Arial; background: #f5f5f5; padding: 20px; }
    form { background: #fff; padding: 20px; border-radius: 8px; max-width: 400px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    input, textarea, select, button { width: 100%; margin-bottom: 10px; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
    .event { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 10px; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .priority-marker { width: 12px; height: 12px; border-radius: 50%; position: absolute; top: 15px; right: 15px; }
    .low { background: green; }
    .medium { background: orange; }
    .high { background: red; }
    #completedEvents { margin-top: 30px; }
  </style>
</head>
<body>
  <h2>Create a New Event</h2>
  <form id="eventForm">
    <input type="text" name="title" placeholder="Title" required>
    <textarea name="description" placeholder="Description"></textarea>
    <input type="date" name="date" required>
    <input type="text" name="location" placeholder="Location">
    <input type="number" name="capacity" placeholder="Capacity">
    <input type="number" step="0.01" name="price" placeholder="Price">
    <select name="priority">
      <option value="low">Low Priority</option>
      <option value="medium">Medium Priority</option>
      <option value="high">High Priority</option>
    </select>
    <button type="submit">Create Event</button>
  </form>

  <button id="showEventsBtn">Show Events</button>
  <h2>All Events</h2>
  <div id="eventsContainer"></div>

  <h2>Completed Events</h2>
  <div id="completedEvents"></div>

  <script>
    const token = localStorage.getItem("token");
    if(!token) window.location.href = "login.html";

    const form = document.getElementById("eventForm");
    const showBtn = document.getElementById("showEventsBtn");
    const container = document.getElementById("eventsContainer");
    const completedContainer = document.getElementById("completedEvents");

    form.addEventListener("submit", async function(e){
      e.preventDefault();
      const data = {
        title: this.title.value,
        description: this.description.value,
        date: this.date.value,
        location: this.location.value,
        capacity: parseInt(this.capacity.value),
        price: parseFloat(this.price.value),
        priority: this.priority.value
      };

      try {
        const res = await fetch("/events", {
          method: "POST",
          headers: { 
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
          },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        alert(result.success ? "Event Created Successfully!" : result.error);
        form.reset();
      } catch(err) {
        alert("Error: " + err.message);
      }
    });

    async function fetchEvents() {
      try {
        const res = await fetch("/events", {
          headers: { "Authorization": "Bearer " + token }
        });
        const events = await res.json();
        container.innerHTML = "";
        completedContainer.innerHTML = "";
        if(events.length === 0) container.innerHTML = "<p>No events found.</p>";
        else events.forEach(ev => {
          const div = document.createElement("div");
          div.className = "event";
          div.innerHTML = `
            <div class="priority-marker ${ev.priority.toLowerCase()}"></div>
            <h3>${ev.title}</h3>
            <p><strong>Description:</strong> ${ev.description || "N/A"}</p>
            <p><strong>Date:</strong> ${new Date(ev.date).toLocaleDateString()}</p>
            <p><strong>Location:</strong> ${ev.location || "N/A"}</p>
            <p><strong>Capacity:</strong> ${ev.capacity || 0}</p>
            <p><strong>Booked Seats:</strong> ${ev.bookedSeats || 0}</p>
            <p><strong>Price:</strong> $${ev.price || 0}</p>
            <p><strong>Priority:</strong> ${ev.priority}</p>
          `;

          if (!ev.completed) {
            const doneBtn = document.createElement("button");
            doneBtn.textContent = "Mark as Done";
            doneBtn.onclick = async () => {
              await fetch("/events/" + ev._id + "/complete", {
                method: "PUT",
                headers: { "Authorization": "Bearer " + token }
              });
              fetchEvents();
            };
            div.appendChild(doneBtn);
            container.appendChild(div);
          } else {
            completedContainer.appendChild(div);
          }
        });
      } catch(err) {
        container.innerHTML = "<p>Error fetching events.</p>";
      }
    }

    showBtn.addEventListener("click", fetchEvents);
  </script>
</body>
</html>
